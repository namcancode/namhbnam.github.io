<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Type Ahead üëÄ</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">

    </ul>
  </form>
  <script>
    var api, description, currenttemp, mintemp, maxtemp, city, live, idpoop, namepoop;

    const apiWeather = [];
    const idCity = 'https://raw.githubusercontent.com/namhbnam/namhbnam.github.io/master/HomeWork/Study/Wesbos-30daysJS/06-Type%20Ahead/city.list.json'
    const endpoint = 'http://api.openweathermap.org/data/2.5/weather';
    // const endpoints =
    //   'http://api.openweathermap.org/data/2.5/weather?q=hanoi&appid=f52d4aa6d8a4fa337c268df3999687b6&units=metric';
    const cities = [];
    // const prom = fetch(endpoint);
    // console.log('prom :', prom);

    // fetch(endpoint)
    //   .then(blob =>console.log(blob.json()))
    // .then(data => cities.push(...data));

    fetch(idCity)
      .then(blob => {
    console.log('object :', blob.json());    
      })

    function getApi() {
      // body
      live = this.value;
      let convert = parseInt(live);
       apiWeather.find(name => {
        if (name.id === convert) {
          live = name.name;
          idpoop = name.id;
          console.log('idpoop :', idpoop);
        }
      });
     
      // console.log('convert :', typeof(convert));
      if (convert >= 0) {
        api = `${endpoint}?id=${this.value}&appid=f52d4aa6d8a4fa337c268df3999687b6&units=metric`
      } else {
        api = `${endpoint}?q=${this.value}&appid=f52d4aa6d8a4fa337c268df3999687b6&units=metric`
      }

      fetchApi();
    }

    function fetchApi() {
      fetch(api).then(blob => {
        blob.json().then(data => {
          if (typeof (data["cod"]) == "string") {
            description = "kh√¥ng r√µ";
            currenttemp = "...";
            mintemp = "...";
            maxtemp = "...";
            city = "kh√¥ng t√¨m th·∫•y";
            idpoop = "0";
            displayMatch();
            // console.clear();
            // console.log('L·ªói t√™n th√†nh ph·ªë ');

          } else {
            city = live;
            description = data["weather"][0]["description"];
            currenttemp = data["main"]["temp"];
            mintemp = data["main"]["temp_min"];
            maxtemp = data["main"]["temp_max"]
            idpoop = data.id;
            displayMatch();
            // console.clear();
            // console.log('data :', data);
          }
        })
      })

    }



    function displayMatch() {
      const matchArray = currenttemp;
      return suggestions.innerHTML =
        `
      <li>
          <p class="name">Th√†nh Ph·ªë: ${city} - Id: ${idpoop}</p>
          <p class="name">Hi·ªán t·∫°i: ${currenttemp} &deg;C</p>
          <p class="name">Tr·∫°ng th√°i: ${description}</>
          <p class="population">Cao nh·∫•t: ${maxtemp} &deg;C</>
          <p class="population">Nh·ªè nh·∫•t: ${mintemp} &deg;C</>
      </li>
    `;


      //  console.log('html :', html);

    }













    // function findMatches(wordToMatch, cities) {
    //   return cities.filter(place => {
    //     // console.log(place); //Tr·∫£ v·ªÅ 1 lo·∫°t object
    //     // console.log('place.city :', place.city);
    //     // here we need to figure out if the city or state matches what was searched
    //     // c·∫ßn t√¨m cho m·ªôt v·ªã tr√≠ nh·∫•t ƒë·ªãnh
    //     const regex = new RegExp(wordToMatch, 'gi');
    //      return place.city.match(regex) ||place.state.match(regex)  //object c·∫ßn t√¨m ƒë√∫ng t√™n th√†nh ph·ªë
    //   });
    // }

    // function displayMatches () {
    //   // body
    //   console.log('this.value :', this.value);
    //  const matchArray =  findMatches(this.value, cities);
    //  const html = matchArray.map(place =>{
    //    const regex = new RegExp(this.value, 'gi')
    //    const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`)
    //    const stateName = place.city.replace(regex, `<span class="hl">${this.value}</span>`)
    //    return `
    //     <li>
    //         <span class="name">${cityName}, ${stateName}</span>
    //         <span class="population">S·ªë d√¢n: ${place.population} </span>
    //       </li>

    //    `
    //  }).join("")
    // //  console.log('html :', html);
    //  suggestions.innerHTML = html
    // }


    const searchInput = document.querySelector(".search");
    const suggestions = document.querySelector(".suggestions");
    // searchInput.addEventListener("input", displayMatches)
    searchInput.addEventListener("input", getApi)
  </script>
</body>

</html>